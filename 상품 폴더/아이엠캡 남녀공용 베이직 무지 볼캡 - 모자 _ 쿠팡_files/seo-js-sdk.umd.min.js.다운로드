!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(e="undefined"!=typeof globalThis?globalThis:e||self).CoupangSeoWebLog=a()}(this,(function(){"use strict";var e,a,o;!function(e){e.production="production",e.development="development"}(e||(e={})),function(e){e.SRP="SRP",e.PLP="PLP",e.SDP="SDP",e.GW="GW",e.SHOP="SHOP",e.PROMOTIONS="PROMOTIONS",e.TODAY_OPEN="TODAY_OPEN",e.BRAND_SHOP="BRAND_SHOP",e.OMP="OMP",e.COUPANG_BENEFITS="COUPANG_BENEFITS",e.BEST_100="BEST_100",e.WOW_CARD="WOW_CARD",e.BLOG="blog",e.RLUX="RLUX"}(a||(a={})),function(e){e.PCWeb="web",e.MWeb="mweb"}(o||(o={}));const n={[o.PCWeb]:[{name:"Google",referrer:[".google."],campaign:{spec:"10917115",src:"4502016"}},{name:"Naver",referrer:["naver.com","search.naver.com","m.search.naver.com","m.naver.com"],exclude:["adcr.naver.com"],campaign:{spec:"10917115",src:"4502001"}},{name:"Daum",referrer:[".daum."],campaign:{spec:"10917115",src:"4502002"}},{name:"Bing",referrer:[".bing."],campaign:{spec:"10917115",src:"4502888"}},{name:"Yahoo",referrer:[".yahoo."],campaign:{spec:"10917115",src:"4502887"}}],[o.MWeb]:[{name:"Google",referrer:[".google."],campaign:{spec:"10917115",src:"4503016"}},{name:"Naver",referrer:["naver.com","search.naver.com","m.search.naver.com","m.naver.com"],exclude:["adcr.naver.com"],campaign:{spec:"10917115",src:"4503001"}},{name:"Daum",referrer:[".daum."],campaign:{spec:"10917115",src:"4503002"}},{name:"Bing",referrer:[".bing."],campaign:{spec:"10917115",src:"4503888"}},{name:"Yahoo",referrer:[".yahoo."],campaign:{spec:"10917115",src:"4503887"}}]},t=e=>({sources:n[e]}),r=[{page:"GW",pattern:["^https://www.coupang.com/$","^https://m.coupang.com/$"],addtag:"900"},{page:"SDP",pattern:["www.coupang.com/vp/products","m.coupang.com/vm/products"],addtag:"400"},{page:"PLP",pattern:["www.coupang.com/np/categories","www.coupang.com/np/campaigns","www.coupang.com/np/coupangglobal","m.coupang.com/nm/plp","coupang.com/nm/section/sm/617","coupang.com/nm/section/sm/609","coupang.com/nm/section/sm/542"],addtag:"300"},{page:"SRP",pattern:["www.coupang.com/np/search","m.coupang.com/nm/search"],addtag:"200"},{page:"SHOP",pattern:["https://shop.coupang.com/.+"],addtag:"700"},{page:"PROMOTIONS",pattern:["https://pages.coupang.com/p/.+","www.coupang.com/vp/promotions/\\d+/event","https://pages.coupang.com/m/.+","https://pages.coupang.com/f/.+"],addtag:"26"},{page:"TODAY_OPEN",pattern:["www.coupang.com/np/todayopen","https://www.coupang.com/np/todayopen/categories"],addtag:"31"},{page:"BRAND_SHOP",pattern:["www.coupang.com/np/products/brand-shop"],addtag:"61"},{page:"OMP",pattern:["www.coupang.com/np/omp"],addtag:"71"},{page:"COUPANG_BENEFITS",pattern:["www.coupang.com/np/coupangbenefit","coupang.com/nm/section/collection/homeEvent"],addtag:"81"},{page:"BEST_100",pattern:["www.coupang.com/np/best100/bestseller","www.coupang.com/np/best100/trending"],addtag:"41"},{page:"WOW_CARD",pattern:["www.coupang.com/vp/wowcard","m.coupang.com/vm/wowcard"],addtag:"51"},{page:"blog",pattern:["guide.coupang.com"],addtag:"72"},{page:"RLUX",pattern:["rlux.coupang.com"],addtag:"73"}],c={enabled:!0,platform:o.PCWeb,cookieEnabled:!1,sdkVersion:"1.0.0"},i={enabled:!0,platform:o.MWeb,cookieEnabled:!1,sdkVersion:"1.0.0"},g={[o.PCWeb]:c,[o.MWeb]:i},s=e=>g[e];var p={getCookie(e){let a;const o=e+"=",n=decodeURIComponent(document.cookie).split(";");for(a=0;a<n.length;a++){let e=n[a];for(;" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(o))return e.substring(o.length,e.length)}return""},setCookie(e,a,o,n,t,r){const c=new Date(2100,1,1),i=(e=>{const a=e.split(".");return 3!==a.length&&4!==a.length?e:e.replace(/^(?:[\w\d]+\.)?([^:/]*).*$/i,"$1")})(decodeURIComponent(document.domain)),g=[];g.push(`${e}=${encodeURIComponent(a)}`),g.push(`; expires=${o&&o.toUTCString()||c.toUTCString()}`),g.push(`; domain=${n||i}`),g.push(`; path=${t||"/"}`),g.push(r&&"; secure"),document.cookie=g.join("")}},m={COOKIE:{PCID:"PCID",MEMBERSRL:"member_srl",ISAPP:"ISAPP",CAMPAIGN:["trac_src","trac_spec","trac_addtag","trac_ctag","trac_lptag"]}},d={getCampaignParameter(){const e={};return m.COOKIE.CAMPAIGN.map((a=>{const o=a.replace(/^trac_/,""),n=p.getCookie(a).replace(/"/g,"");e[o]="0"!==n&&n||""})),e.src&&e.spec&&{campaign:e}||{}},setCampaignParameter(e){m.COOKIE.CAMPAIGN.map((a=>{const o=a.replace(/^trac_/,""),n=e[o]||"";p.setCookie(a,n)}))}};const u=(e,a,o,n)=>{let t="";return t+=`%c[${e}/${a}]`,t+=` :  ${o}`,{message:t,color:n=`color: ${n};`}};var l={isDebugEnabled:!1,setDebugMode:function(){this.isDebugEnabled=!0},d:function(e,a){if(window?.console&&this.isDebugEnabled){const o=u("Debug",e,a,"purple");o.color?console.log(o.message,o.color):console.log(o.message)}},i:function(e,a){if(window?.console&&this.isDebugEnabled){const o=u("Info",e,a,"green");o.color?console.info(o.message,o.color):console.info(o.message)}},w:function(e,a){if(window?.console&&this.isDebugEnabled){const o=u("Warn",e,a,"orange");o.color?console.warn(o.message,o.color):console.warn(o.message)}},e:function(e,a){if(window?.console&&this.isDebugEnabled){const o=u("Error",e,a,"red");o.color?console.error(o.message,o.color):console.error(o.message)}}};const w={[a.GW]:()=>({ctag:"home",lptag:"coupang"}),[a.SDP]:()=>{const e=/v[p|m]\/products\/(quick-view\/){0,}([0-9]*)/.exec(window.location.pathname)?.[2];return{ctag:e,lptag:e}},[a.PLP]:()=>{const e="/np/coupangglobal"===window.location.pathname?"coupangglobal":/(nm\/plp|np\/categories|np\/campaigns|nm\/section\/sm)\/([0-9]*)/.exec(window.location.pathname)?.[2];return{ctag:e,lptag:e}},[a.SRP]:()=>{const e=new URLSearchParams(window.location?.search),a=e?.get("q");return{ctag:a,lptag:a}},[a.SHOP]:()=>{const e=window.__NUXT__?.state?.store?.vendorId||"";return{ctag:e,lptag:e}},[a.PROMOTIONS]:()=>{let e="";return e=window.location.pathname.endsWith("/event")?/vp\/promotions\/(\d+)\/event/.exec(window.location.pathname)[1]:/[p|m|f]\/(.+)/.exec(window.location.pathname)?.[1],{ctag:e,lptag:e}},[a.TODAY_OPEN]:()=>{const e="/np/todayopen"===window.location.pathname?"todayopen":/np\/todayopen\/categories\/([0-9]*)/.exec(window.location.pathname)?.[1];return{ctag:e,lptag:e}},[a.BRAND_SHOP]:()=>{const e=new URLSearchParams(window.location?.search),a=e?.get("brandName");return{ctag:a,lptag:a}},[a.OMP]:()=>({ctag:"omp",lptag:"omp"}),[a.COUPANG_BENEFITS]:()=>({ctag:"coupangbenefit",lptag:"coupangbenefit"}),[a.BEST_100]:()=>{const e=/np\/best100\/(bestseller|trending)\/([0-9]*)/.exec(window.location.pathname)?.[2];return{ctag:e??"Best100",lptag:e??"Best100"}},[a.WOW_CARD]:()=>({ctag:"wowcard",lptag:"wowcard"}),[a.BLOG]:()=>({ctag:"blog",lptag:"blog"}),[a.RLUX]:()=>({ctag:"rlux",lptag:"rlux"})},f="SEOWebLog",b="data-seo-rule",h="data-mode";return new class{campaignParameter;constructor(){if(window.CoupangSeoWebLog)return;if(!window.CoupangWebLog)return l.setDebugMode(),void l.w(f,"#constructor - Not found window.CoupangWebLog(#coupang-web-log) for initialize");const a=document.getElementById("seo-js-sdk");if(a){"production"!==(a.getAttribute(h)||"production")&&l.setDebugMode();const o={seoRule:JSON.parse(a.getAttribute(b))||undefined,mode:a.getAttribute(h)||e.production};l.d(f,"#constructor - use custom attribute(data-mode, data-seo-rule) for initialize"),this.init(o)}else l.d(f,"#constructor - Not found script tag(#seo-js-sdk) for initialize")}refactorInitData(e){const a=(()=>{const e=window.navigator?.userAgent;return/Mobile|mobile/i.test(e)?o.MWeb:o.PCWeb})();l.d(f,`#refactorInitData platform: ${a}`);const{cookieEnabled:n,sources:c,paths:i}=(e=>({...s(e),...t(e),paths:r}))(a||o.PCWeb);return{...e,seoRule:{cookieEnabled:n,sources:c,paths:i,...e?.seoRule}}}init(a){l.d(f,`#init -\n${JSON.stringify(a,undefined,2)}`);const o=this.refactorInitData(a),n=this.getEffectiveTrafficData(o);if(n){const{path:a,source:r}=n;l.d(f,`#init - Effective SEO Traffic: Source name: ${r?.name}  Path page: ${a?.page}`);const c={meta:{schemaId:o?.mode===e.production?14506:8261,schemaVersion:1},data:{logCategory:"campaign",logType:"landing",domain:"SEO",pageName:a?.page||"",eventName:"seo_traffic_landing",page:a?.page||"",source:r?.name||"",landingUrl:window.location?.href,referrerUrl:window.document.referrer}},i=o?.seoRule?.cookieEnabled,g={...r?.campaign,addtag:a?.addtag,...(t=a?.page,w[t]?w[t]():{ctag:"",lptag:""})};i&&(this.rewriteCampaignCookie(g),l.d(f,"#init - Campaign cookie has been rewritten")),l.d(f,`#init - Cookie CampaignParameter \n${JSON.stringify(d.getCampaignParameter(),undefined,2)}`),l.d(f,`#init - Before rewrite WebLog CampaignParameter \n${JSON.stringify(window.CoupangWebLog.campaignParameter,undefined,2)}`),this.rewriteWebLogCampaignParameter(g),l.d(f,`#init - After rewrite WebLog CampaignParameter \n${JSON.stringify(window.CoupangWebLog.campaignParameter,undefined,2)}`),window.CoupangWebLog?.submit(c),l.d(f,"#init - SEO log has been sent."),i||(this.resetWebLogCampaignParameter(),l.d(f,`#init - After reset WebLog CampaignParameter \n${JSON.stringify(window.CoupangWebLog.campaignParameter,undefined,2)}`))}else l.d(f,"#init - Uneffective SEO Traffic");var t;return this}getEffectiveTrafficData(e){if(function(){const e=window.navigator.userAgent;return/bot|googlebot|crawler|spider|robot|crawling/i.test(e)}()||function(){const e=new URLSearchParams(window.location?.search);return!!["src","spec","addtag","lptag","ctag"].some((a=>e.has(a)))||!!window.location?.pathname?.startsWith("adcr.naver.com")}())return;const a=this.getSeoSourceByReferrer(e);if(!a)return;const o=this.getSeoPathByUrl(e);return o?{source:a,path:o}:void 0}getSeoSourceByReferrer(e){const a=window.document.referrer;if(!a||!function(e){try{return new URL(e),!0}catch(a){return!1}}(a))return;const o=new URL(a),n=e?.seoRule?.sources?.find((e=>e.referrer.some((e=>o?.host?.includes(e)))&&!e.exclude?.some((e=>o?.host?.includes(e)))));return n}getSeoPathByUrl(e){const{protocol:a,hostname:o,pathname:n}=window.location,t=`${a}//${o}${n}`,r=e?.seoRule?.paths?.find((e=>e.pattern?.some((e=>t.match(new RegExp(e))))));return r}rewriteCampaignCookie(e){d.setCampaignParameter(e)}rewriteWebLogCampaignParameter(e){this.campaignParameter=window.CoupangWebLog.campaignParameter,window.CoupangWebLog.campaignParameter={...window.CoupangWebLog.campaignParameter,campaign:{...window.CoupangWebLog.campaignParameter?.campaign,...e}}}resetWebLogCampaignParameter(){window.CoupangWebLog.campaignParameter=this.campaignParameter,this.campaignParameter=null}}}));
//# sourceMappingURL=seo-js-sdk.umd.min.js.map
